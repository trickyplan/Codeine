<?php
    
    /* Codeine
     * @author bergstein@trickyplan.com
     * @description  
     * @package Codeine
     * @version 8.x
     */
    
    setFn('Check', function ($Call)
    {
        $URLs = F::Dot($Call, 'Google.SafeBrowsing.URLs');
        
        $Entries = [];
        foreach ($URLs as $URL)
            $Entries[] = ['url' => $URL];
        
        $Call = F::Dot($Call, 'Google.SafeBrowsing.Request.threatInfo.threatEntries', $Entries);
        
        $Call['Result'] = F::Run('IO', 'Write', $Call,
            [
                'Storage'           => 'Web',
                'Format'            => 'Formats.JSON',
                'Output Format'     => 'Formats.JSON',
                'CURL'              =>
                [
                    'Headers'  =>
                    [
                        'Content-Type: application/json'
                    ]
                ],
                'Where'     =>
                [
                    'ID' => F::Dot($Call, 'Google.SafeBrowsing.Endpoint').'?key='.F::Dot($Call, 'Google.SafeBrowsing.APIKey')
                ],
                'Data'      => F::Dot($Call, 'Google.SafeBrowsing.Request'),
                'IO One'    => true
            ]);
        
        $Call['Result']['Safe'] = empty($Call['Result']);
        return $Call['Result'];
    });